<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>五子棋</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      canvas {
        /* border: 1px solid red; */
        background: #f3ca70;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="500" height="500"></canvas>
    <button>悔棋</button>
    <script>
      const socket = new WebSocket("ws://localhost:8081")

      socket.onopen = function (event) {
        socket.send("Here's some text that the server is urgently awaiting!")
      }

      socket.onmessage = function (event) {
        console.log(event.data)
      }
      /**
       * 先黑后白
       */
      const canvas = document.getElementById("canvas")
      const button = document.querySelector("button")
      const ctx = canvas.getContext("2d")
      const list = []

      function setLine() {
        for (let i = 1; i < 21; i++) {
          ctx.beginPath()
          ctx.moveTo(20, i * 20)
          ctx.lineTo(400, i * 20)
          ctx.stroke()
        }

        for (let i = 1; i < 21; i++) {
          ctx.beginPath()
          ctx.moveTo(i * 20, 20)
          ctx.lineTo(20 * i, 400)
          ctx.stroke()
        }
      }

      function handlerClick() {
        canvas.addEventListener(
          "click",
          (e) => {
            const { clientX, clientY } = e
            const X = Math.round(clientX / 20) * 20
            const Y = Math.round(clientY / 20) * 20
            list.push({
              x: X,
              y: Y,
              color: list.length % 2 === 0 ? "black" : "white",
            })
            ctx.beginPath()
            ctx.arc(X, Y, 10, 0, 2 * Math.PI, false)
            ctx.fillStyle = list.length % 2 === 0 ? "white" : "black"
            ctx.fill()
          },
          false
        )
      }

      button.addEventListener("click", (e) => {
        list.pop()
        ctx.clearRect(0, 0, canvas.width, canvas.height)
        setLine()

        list.forEach((item) => {
          console.log(item)
          ctx.beginPath()
          ctx.arc(item.x, item.y, 10, 0, 2 * Math.PI, false)
          ctx.fillStyle = item.color
          ctx.fill()
        })
      })

      setLine()
      handlerClick()
    </script>
  </body>
</html>
